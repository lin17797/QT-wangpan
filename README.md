# C++ Qt Cloud-Pan - 现代化网络云盘与即时通讯平台

## 1\. 项目简介

**C++ Qt Cloud-Pan** 是一个基于C++11和Qt框架开发的C/S架构网络云盘项目。它不仅提供了稳定高效的文件存储与管理功能，还创新性地集成了好友系统与即时通讯模块，旨在打造一个功能全面、性能卓越、体验流畅的桌面级云端协作平台。

项目在实现功能的同时，深度实践了现代化C++的编程范式，尤其在内存管理、并发编程和软件架构设计上进行了精心的重构与优化，使其成为一个优秀的C++与Qt综合应用案例。

## 2\. 功能特性

本项目实现了丰富的功能，主要分为以下几大模块：

  * **用户管理系统**:

      * **注册与登录**: 提供安全的用户注册和登录认证。
      * **在线状态**: 实时同步用户的在线状态。
      * **用户查找**: 支持按用户名精确查找平台内的其他用户。

  * **好友系统**:

      * **添加/删除好友**: 支持发送好友请求、同意/拒绝请求以及单向删除好友。
      * **好友列表**: 实时刷新并展示好友及其在线状态。

  * **云盘文件系统**:

      * **文件/文件夹管理**: 支持在云端创建文件夹、删除、重命名和移动文件或文件夹。
      * **文件列表刷新**: 实时获取并展示当前目录下的所有文件和文件夹。
      * **多线程上传/下载**: 支持带进度条显示的大文件上传和下载，操作期间UI保持流畅响应。
      * **文件分享**: 可一键将选中的文件或文件夹分享给一位或多位在线好友。

  * **即时通讯 (IM)**:

      * **私聊**: 支持与好友进行一对一的私密聊天。
      * **群聊**: 支持向所有在线好友发送广播消息。

## 3\. 技术栈

| 类别 | 技术 | 描述 |
| :--- | :--- | :--- |
| **编程语言** | `C++11` | 全面采用C++11标准进行开发，利用其现代特性提升代码质量。 |
| **核心框架** | `Qt 5/6` | 作为项目的基石，提供了GUI、网络、多线程、数据库等全方位支持。 |
| **前端GUI** | `Qt Widgets` | 用于构建功能丰富且响应迅速的桌面用户界面。 |
| **网络通信** | `Qt Network` | 使用`QTcpServer`和`QTcpSocket`实现稳定高效的TCP/IP长连接通信。 |
| **并发模型** | `QThread` | 将耗时的文件传输任务移至工作线程，实现UI与业务逻辑分离。 |
| **数据库** | `SQLite` | 在服务器端作为轻量级数据库，持久化存储用户信息和好友关系。 |
| **设计模式** | 单例模式, 工厂模式 | 用于管理全局实例和解耦对象创建。 |

## 4\. 核心技术亮点

1.  **现代化内存管理与资源安全**:

      * 项目全面拥抱C++11的**RAII**思想，通过\*\*`std::unique_ptr`智能指针\*\*管理所有动态创建的协议数据单元（PDU）对象。这种做法从根本上杜绝了内存泄漏和悬挂指针的风险，极大地提升了代码的健壮性与安全性。

2.  **自定义二进制通信协议**:

      * 设计并实现了一套高效的自定义二进制通信协议（PDU）。通过精确定义消息头（包含包体总长度）与消息体，并结合应用层缓冲区，彻底解决了TCP传输中的**粘包/半包**问题，保证了数据解析的准确性。

3.  **多线程并发模型**:

      * 采用Qt的**工作线程（Worker-Thread）模型，将客户端的文件上传与下载等耗时I/O操作完全移至独立的`QThread`中处理。通过信号槽机制**进行线程间安全通信，确保了主线程（GUI线程）在处理大文件传输时毫无阻塞，提供了流畅的用户体验。

4.  **数据库安全与性能**:

      * 在服务器端深度集成SQLite，并全面采用**预处理语句（Prepared Statements）进行数据库操作。此举从根本上杜绝了SQL注入**的安全风险，同时有效提升了数据访问性能。

## 5\. 如何编译与运行

### **环境要求**

  * Qt 5.12 或更高版本
  * 支持C++17的编译器 (GCC, Clang, MSVC)
  * SQLite 3

### **编译步骤**

1.  使用Qt Creator分别打开 `TcpServer/TcpServer.pro` 和 `TcpClient/TcpClient.pro` 项目文件。
2.  配置项目构建套件 (Kit)。
3.  **重要**: 在服务器端 `opedb.cpp` 文件的 `init()` 方法中，需要将数据库文件 `cloud.db` 的路径修改为您自己系统中的**绝对路径**。
    ```cpp
    // opedb.cpp
    void OpeDB::init()
    {
        // 请修改为您的绝对路径
        m_db.setDatabaseName("/path/to/your/project/TcpServer/cloud.db"); 
        // ...
    }
    ```
4.  分别构建客户端和服务器项目。

### **运行步骤**

1.  首先运行生成的可执行文件 `TcpServer`。
2.  然后运行一个或多个可执行文件 `TcpClient`。
3.  在客户端界面进行注册和登录后即可开始使用。

## 6\. 项目结构

```
QT-wangpan/
├── TcpClient/              # 客户端源码
│   ├── book.cpp/h          # 文件管理界面
│   ├── friend.cpp/h        # 好友与聊天界面
│   ├── online.cpp/h        # 在线用户界面
│   ├── privatechat.cpp/h   # 私聊窗口
│   ├── sharefile.cpp/h     # 文件分享窗口
│   ├── tcpclient.cpp/h     # 客户端主逻辑与网络核心
│   ├── fileuploadworker.cpp/h  # 上传文件的工作线程类
│   ├── filedownloadworker.cpp/h# 下载文件的工作线程类
│   └── ...
├── TcpServer/              # 服务器端源码
│   ├── mytcpserver.cpp/h   # 服务器主类，监听和管理连接
│   ├── mytcpsocket.cpp/h   # 处理单个客户端连接的socket类
│   ├── opedb.cpp/h         # 数据库操作封装类
│   ├── protocol.cpp/h      # 协议数据单元(PDU)的实现
│   ├── cloud.db            # 服务器端SQLite数据库文件
│   └── ...
├── protocol.h              # 客户端与服务器共用的协议头文件
└── README.md               # 本文档
```
